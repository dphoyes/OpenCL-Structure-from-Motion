digraph G {

    main [label="Libviso2\nStructure from Motion"]

    foreach_frame [label="For each frame" shape="trapezium"]
    visoProcess [shape="box" label="VisualOdometryMono::\nvisoProcess\n(Image -> Feature matches, Motion)"]

    reconstructionUpdate [shape="box" label="Reconstruction::\nupdate\n(Feature matches, Motion -> 3D Points)"]

    matcher_push [shape="box" label="Matcher::\npushBack\n(Image -> features)"]
    computeFeatures [shape="box" label="Matcher::\ncomputeFeatures"]

    matchFeatures [shape="box" label="Matcher::\nmatchFeatures\n(features -> matches)"]

    matching [shape="box" label="Matcher::\nmatching"]
    refinement [shape="box" label="Matcher::\nrefinement"]
    removeOutliers [shape="box" label="Matcher::\nremoveOutliers"]

    flow_method [label="Flow Method"]

    bucketFeatures [shape="box" label="Matcher::\nbucketFeatures\n(matches -> bucketed matches)"]

    updateMotion [shape="box" label="VisualOdometry::\nupdateMotion\n(matches -> motion)"]

    estimateMotion [shape="box" label="VisualOdometryMono::\nestimateMotion"]
    vectorToMatrix [shape="box" label="VisualOdometry::\ntransformationVectorToMatrix"]

    sobel [shape="box" label="filter::\nsobel5x5"]
    blob [shape="box" label="filter::\nblob5x5"]
    checkerboard [shape="box" label="filter::\ncheckerboard5x5"]
    nonMaxSuppression [shape="box" label="Matcher::\nnonMaximumSuppression"]
    computeDescriptors [shape="box" label="Matcher::\ncomputeDescriptors"]

    normalizeFeaturePoints [shape="box" label="VisualOdometryMono::\nnormalizeFeaturePoints"]
    fundamentalMatrix [shape="box" label="VisualOdometryMono::\nfundamentalMatrix"]
    getInlier [shape="box" label="VisualOdometryMono::\ngetInlier"]
    EtoRt [shape="box" label="VisualOdometryMono::\nEtoRt"]
    triangulateChieral [shape="box" label="VisualOdometryMono::\ntriangulateChieral"]
    findPlane [label="Find Best Plane"]
    exp [shape="box" label="exp"]

    associateMatchesToTracks [label="Associate\nmatches to\ntracks"]
    constructPointsFromInactiveTracks [label="Construct\npoints from inactive\ntracks"]

    main -> foreach_frame [penwidth=10]

    foreach_frame -> visoProcess [penwidth=9.45]
    foreach_frame -> reconstructionUpdate [penwidth=2]

    visoProcess -> matcher_push [penwidth=2] 
    matcher_push -> computeFeatures [penwidth=10]
    computeFeatures -> sobel [penwidth=4]
    computeFeatures -> blob [penwidth=2]
    computeFeatures -> checkerboard [penwidth=0.8]
    computeFeatures -> nonMaxSuppression [penwidth=7]
    computeFeatures -> computeDescriptors [penwidth=0.8]

    visoProcess -> matchFeatures [penwidth=2]
    matchFeatures -> matching [penwidth=5]
    matchFeatures -> refinement [penwidth=2]
    matchFeatures -> removeOutliers [penwidth=3]
    
    matching -> flow_method

    visoProcess -> bucketFeatures [penwidth=0.5]
    visoProcess -> updateMotion [penwidth=9.40]

    updateMotion -> estimateMotion [penwidth=10]
    updateMotion -> vectorToMatrix [penwidth=0.5]

    estimateMotion -> normalizeFeaturePoints [penwidth=0.5]
    estimateMotion -> fundamentalMatrix [penwidth=2]
    estimateMotion -> getInlier [penwidth=4]

    estimateMotion -> EtoRt [penwidth=2]
    EtoRt -> triangulateChieral [penwidth=10]
    estimateMotion -> findPlane [penwidth=3]
    findPlane -> exp [penwidth=10]

    reconstructionUpdate -> associateMatchesToTracks [penwidth=5]
    reconstructionUpdate -> constructPointsFromInactiveTracks [penwidth=5]

}